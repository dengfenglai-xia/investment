<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="common/common-head::head"></head>
<link rel="stylesheet" type="text/css" th:href="@{/css/swiper.min.css}"/>
<body>
<div class="layui-fluid">
    <div class="layui-row ">
        <div class="layui-col-md12">
            <div class="layui-card l_shadow">
                <div class="w_deltab">
                    <ul>
                        <a>
                            <li class="delactive">合同信息</li>
                        </a>
                        <a th:href="@{'/queryAuditRecords/' + ${audit.code} + '/' +${audit.version} + '/' +${audit.id} }">
                            <li>审核记录</li>
                        </a>
                    </ul>
                </div>
            </div>
            <div class="w_delcont">
                <div class="w_dellist">
                    <div class="layui-card l_shadow">
                        <div class="mytitle">基本信息</div>
                        <div class="w_part">
                            <div class="w_colxs_4">
                                <span class="htstyle">合同类别：</span>
                                <span class="htcont" th:text="${contract.contractType}"></span>
                            </div>
                            <div class="w_colxs_4">
                                <span class="htstyle">合同编号：</span>
                                <span class="htcont" th:text="${contract.contractCode}"></span>
                            </div>
                            <!--<div class="w_colxs_4">
                                <span class="htstyle">合同状态：</span>
                                <span class="htcont" th:text="${state}"></span>
                            </div>-->
                            <div class="w_colxs_4">
                                <span class="htstyle">签订日期：</span>
                                <span class="htcont" th:text="${contract.signDate}"></span>
                            </div>
                            <div class="w_colxs_4">
                                <span class="htstyle">生效日期：</span>
                                <span class="htcont" th:text="${contract.startDate}"></span>
                            </div>
                            <div class="w_colxs_4">
                                <span class="htstyle">截止日期：</span>
                                <span class="htcont" th:text="${contract.endDate}"></span>
                            </div>
                            <div class="w_colxs_4" th:if="${not #strings.isEmpty(contract.changeDate)}">
                                <span class="htstyle">变更生效日期：</span>
                                <span class="htcont" th:text="${contract.changeDate}"></span>
                            </div>
                        </div>
                    </div>
                    <div class="layui-card l_shadow" th:if="${contract.customerType eq '1'}">
                        <div class="mytitle">租客信息</div>
                        <div class="w_part">
                            <div class="layui-col-xs3">
                                <span class="htstyle">客户类型：</span>
                                <span class="htcont">公司</span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">客户：</span>
                                <span class="htcont" th:text="${contract.customerName}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">所属行业：</span>
                                <span class="htcont" th:text="${contract.industry}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">统一社会信用代码：</span>
                                <span class="htcont" th:text="${contract.unifiedCode}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">法人：</span>
                                <span class="htcont" th:text="${contract.legalPerson}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">联系人：</span>
                                <span class="htcont" th:text="${contract.contacts}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">联系电话：</span>
                                <span class="htcont" th:text="${contract.phone}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">渠道来源：</span>
                                <span class="htcont" th:text="${contract.channelSource}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">渠道名称：</span>
                                <span class="htcont" th:text="${contract.sourceName}"></span>
                            </div>
                            <div class="layui-col-xs6">
                                <span class="htstyle">通讯地址：</span>
                                <span class="htcont" th:text="${contract.linkAddress}"></span>
                            </div>
                        </div>
                    </div>
                    <div class="layui-card l_shadow" th:if="${contract.customerType eq '2'}">
                        <div class="mytitle">租客信息</div>
                        <div class="w_part">
                            <div class="layui-col-xs3">
                                <span class="htstyle">客户类型：</span>
                                <span class="htcont">个人</span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">客户：</span>
                                <span class="htcont" th:text="${contract.customerName}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">联系电话：</span>
                                <span class="htcont" th:text="${contract.phone}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">身份证号：</span>
                                <span class="htcont" th:text="${contract.contactsCard}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">所属行业：</span>
                                <span class="htcont" th:text="${contract.industry}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">渠道来源：</span>
                                <span class="htcont" th:text="${contract.channelSource}"></span>
                            </div>
                            <div class="layui-col-xs3">
                                <span class="htstyle">渠道名称：</span>
                                <span class="htcont" th:text="${contract.sourceName}"></span>
                            </div>
                            <div class="layui-col-xs6">
                                <span class="htstyle">通讯地址：</span>
                                <span class="htcont" th:text="${contract.linkAddress}"></span>
                            </div>
                        </div>
                    </div>
                    <div class="layui-card l_shadow">
                        <div class="mytitle">资源信息</div>
                        <div class="w_part">
                            <div class="w_colxs_5">
                                <span class="htstyle">房源面积：</span>
                                <span class="htcont" th:text="${#numbers.formatDecimal(totalArea, 0, 2)} + ' ㎡'"></span>
                            </div>
                            <div class="w_colxs_5" th:if="${carplaceList.size() > 0}">
                                <span class="htstyle">车位数量：</span>
                                <span class="htcont" th:text="${carplaceList.size()} + ' 个'"></span>
                            </div>
                            <div class="layui-col-xs12">
                                <table class="layui-table">
                                    <colgroup>
                                        <col width="150">
                                        <col width="150">
                                        <col width="150">
                                        <col width="150">
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th>项目</th>
                                        <th>楼宇</th>
                                        <th>房源</th>
                                        <th>面积</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="obj:${roomList}">
                                        <td th:text="${obj.projectName}"></td>
                                        <td th:text="${obj.buildingName}"></td>
                                        <td th:text="${obj.roomNo}">
                                            <!--<a class="tab_hous" th:text="${obj.roomNo}"></a>-->
                                        </td>
                                        <td th:text="${#numbers.formatDecimal(obj.buildArea, 0, 2)} + '㎡'"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="layui-col-xs12" th:if="${carplaceList.size() > 0}">
                                <table class="layui-table">
                                    <colgroup>
                                        <col width="150">
                                        <col width="150">
                                        <col width="150">
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th>项目</th>
                                        <th>楼宇</th>
                                        <th>车位</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="obj:${carplaceList}">
                                        <td th:text="${obj.projectName}"></td>
                                        <td th:text="${obj.buildingName}"></td>
                                        <td th:text="${obj.floorNo}+' - '+ ${obj.buildArea}">
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="layui-card l_shadow">
                        <div class="mytitle">租赁信息</div>
                        <div class="w_part">
                            <div class="w_colxs_5">
                                <span class="htstyle">租赁单价：</span>
                                <span class="htcont"
                                      th:text="${rentList[0].unitPrice} + ' '+ ${CHARGE_UNIT_MAP[rentList[0].chargeUnit]}"></span>
                            </div>
                            <div class="w_colxs_5">
                                <span class="htstyle">日租金：</span>
                                <span class="htcont" th:text="${rentList[0].dayPrice} + ' 元/天'"></span>
                            </div>
                            <div class="w_colxs_5">
                                <span class="htstyle">月租金：</span>
                                <span class="htcont" th:text="${rentList[0].monthPrice} + ' 元/月'"></span>
                            </div>
                            <div class="w_colxs_5">
                                <span class="htstyle">付款周期：</span>
                                <span class="htcont" th:text="${rentList[0].payCycle}+ ' 个月'"></span>
                            </div>
                            <div class="w_colxs_5" th:if="${rentList[0].advancePayType eq '3'}" >
                                <span class="htstyle">付款日：</span>
                                <span class="htcont" th:text="${rentList[0].advancePayDays} + ' 号'"></span>
                            </div>
                            <div class="w_colxs_5" th:if="${rentList[0].advancePayType ne '3'}" >
                                <span class="htstyle">提前付款日：</span>
                                <span class="htcont" th:text="${rentList[0].advancePayDays} + ' 天（'+${ADVANCE_PAY_TYPE_MAP[rentList[0].advancePayType]}+'）'"></span>
                            </div>
                            <div class="w_colxs_5">
                                <span class="htstyle">租金保证金：</span>
                                <span class="htcont" th:text="${contract.deposit}+ ' 元'"></span>
                            </div>
                            <div class="w_colxs_5">
                                <span class="htstyle">物业费押金：</span>
                                <span class="htcont" th:text="${contract.wyDeposit}+ ' 元'"></span>
                            </div>
                            <div class="w_colxs_5">
                                <span class="htstyle">履约保证金：</span>
                                <span class="htcont" th:text="${contract.breachAmt}+ ' 元'"></span>
                            </div>
                        </div>
                    </div>
                    <div class="layui-card l_shadow" th:if="${not #strings.isEmpty(contract.remarks)}">
                        <div class="mytitle">备注信息</div>
                        <div class="w_part">
                            <span class="htcont" th:text="${contract.remarks}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="margin-top: 10px;" th:if="${audit.auditState eq '1'}">
        <button type="button" class="layui-btn layui-btn-primary auditBut">审核</button>
    </div>
</div>
<script th:replace="common/common-js::js"></script>
<script type="text/html" id="audit_open">
    <div class="layui-form" >
        <div class="layui-row ">
            <div class="layui-col-md12 l_po">
                <input type="radio" name="auditState" th:value="2" title="同意" checked="">
                <input type="radio" name="auditState" th:value="3" title="驳回">
            </div>
            <div class="layui-col-md12 l_po">
                <textarea  placeholder="请输入审核意见" id="auditOpinion" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-layout-admin">
            <div class="layui-footer w_type" style="left: 0;">
                <button class="layui-btn layui-btn-normal audit">确认</button>
                <button type="button" class="layui-btn layui-btn-primary cancel" >取消</button>
            </div>
        </div>
    </div>
</script>
<script>
    layui.config({
        base: URL + 'layuiadmin/'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'contlist', 'table', 'laydate' ,'form'], function () {
        var laydate = layui.laydate;
        var admin = layui.admin,
            table = layui.table;
        var form = layui.form;

        $('body').on('click', '.auditBut', function () {
            layer.open({
                type: 1
                ,title: '审核'
                ,content: $('#audit_open').html()
                ,maxmin: false
                ,area: ['420px', '280px']
            });
            form.render();
        });

        $('body').on('click','.audit', function(){
            var auditState = $('input[name="auditState"]:checked').val();
            var auditOpinion = $.trim($("#auditOpinion").val());
            if (auditState == '3' && auditOpinion == '') {
                layer.msg("请填写审核意见");
                return;
            }
            $.ajax({
                url: URL + "updateAuditOper",
                type:"POST",
                data: {
                    id: [[${audit.id}]],
                    matterId: '[[${audit.matterId}]]',
                    sign:'[[${audit.sign}]]',
                    sort:'[[${audit.sort}]]',
                    code:'[[${audit.code}]]',
                    version:'[[${audit.version}]]',
                    auditState: auditState,
                    auditOpinion: auditOpinion
                },
                dataType:"json",
                success:function(data){
                    if(data.success){
                        layer.msg(data.msg);
                        setTimeout(function () {
                            parent.location.reload();
                        }, 1000);
                    }else{
                        layer.msg(data.msg);
                    }
                }
            });
        });
    });

    //取消按钮
    $('body').on('click', '.cancel', function () {
        layer.closeAll(); //关闭弹层
    })

    $('.z_housing_tit').click(function () {
        if ($(this).parents('.z_housing').hasClass('l_listblock')) {
            $(this).parents('.z_housing').removeClass('l_listblock')
        } else {
            $(this).parents('.z_housing').removeClass('l_listblock')
            $(this).parents('.z_housing').addClass('l_listblock')
        }
    })
    $('body').on('click', '.w_deltab li', function () {
        $(this).addClass('delactive').siblings().removeClass('delactive');
    })

</script>
</body>

</html>