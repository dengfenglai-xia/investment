<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="common/common-head::head">
<body>
<div class="w_addbox">
    <form id="form" class="house_page1 layui-form">
        <!--基本信息-->
        <div class="layui-row layui-form-item">
            <div class="mytitle">
                基本信息
            </div>
            <div class="w_addpart l_shadow">
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label "><b class="w_sur">*</b>客户类型：</label>
                    <div class="layui-input-block">
                        <input type="radio" name="customerType" value="1" title="公司" lay-filter="customerType-select"
                               checked="">
                        <input type="radio" name="customerType" value="2" title="个人" lay-filter="customerType-select">
                    </div>
                </div>
                <!--公司/个人租赁信息-->
                <div class="lease-info-switch"></div>
                <div class="clear"></div>
            </div>
        </div>
        <!--基本信息end-->
        <div class="layui-row layui-form-item bc_msg" id="gsxx">
            <div class="mytitle">工商信息</div>
            <div class="w_addpart l_shadow w_bccont">
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label l_hg">统一社会&nbsp;&nbsp;&nbsp;<br/>信用代码：</label>
                    <div class="layui-input-block">
                        <input type="text" name="unifiedCode" placeholder="请输入统一社会信用代码"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">工商注册号：</label>
                    <div class="layui-input-block">
                        <input type="text" name="businessRegNo" placeholder="请输入工商注册号"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">组织机构代码：</label>
                    <div class="layui-input-block">
                        <input type="text" name="organCode" placeholder="请输入组织机构代码"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">法&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;人：</label>
                    <div class="layui-input-block">
                        <input type="text" name="legalPerson" placeholder="请输入法人" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">注册资本：</label>
                    <div class="layui-input-block">
                        <input type="text" name="regCapital" placeholder="请输入注册资本"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">经营状态：</label>
                    <div class="layui-input-block">
                        <input type="text" name="businessState" placeholder="请输入经营状态"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">公司类型：</label>
                    <div class="layui-input-block">
                        <input type="text" name="companyType" placeholder="请输入公司类型"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">登记机关：</label>
                    <div class="layui-input-block">
                        <input type="text" name="regOffice" placeholder="请输入登记机关"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label">核准日期：</label>
                    <div class="layui-input-block">
                        <input type="text" name="passDate" class="layui-input l_time laydate-control"
                               placeholder="请选择核准日期">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label">成立日期：</label>
                    <div class="layui-input-block">
                        <input type="text" name="buildDate" class="layui-input l_time laydate-control"
                               placeholder="请选择成立日期">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label">营业期限：</label>
                    <div class="layui-input-block">
                        <input type="text" name="businessTerm" class="layui-input" placeholder="请输入营业期限">
                    </div>
                </div>
                <div class="layui-col-md4 layui-col-xs6 l_po">
                    <label class="layui-form-label w_label ">人员规模：</label>
                    <div class="layui-input-block">
                        <input type="text" name="peopleScale" placeholder="请输入人员规模"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-xs8 l_po">
                    <label class="layui-form-label w_label ">注册地址：</label>
                    <div class="layui-input-block">
                        <input type="text" name="regAddress" placeholder="请输入通讯地址"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-xs12 l_po">
                    <label class="layui-form-label w_label ">经营范围：</label>
                    <div class="layui-input-block">
                        <textarea class="w_tzteaxer" name="businessScope" placeholder="请输入经营范围"></textarea>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </div>
        <!--工商信息end-->
        <div class="w_del_btnbox">
            <input type="button" value="保存" class="layui-btn layui-btn-normal" lay-submit lay-filter="commit"/>
            <input type="button" value="取消" class="layui-btn layui-btn-primary cancel"/>
        </div>
    </form>
</div>
<script th:replace="common/common-js::js"></script>
<script th:src="@{/js/template.js}"></script>
<!-- 弹窗、模板 -->
<!--公司信息部分start-->
<script type="text/html" id="company_part">
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>客户名称：</label>
        <div class="layui-input-block">
            <input type="text" name="customerName" lay-verify="required" placeholder="请输入客户名称"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>联&nbsp;&nbsp;系&nbsp;&nbsp;人：</label>
        <div class="layui-input-block">
            <input type="text" name="contacts" lay-verify="required" placeholder="请输入联系人"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>联系电话：</label>
        <div class="layui-input-block">
            <input type="text" name="phone" lay-verify="required|phone" placeholder="请输入联系电话"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>行业类型：</label>
        <div class="layui-input-block">
            <select name="industry" lay-verify="required" lay-search>
                <option value="">请选择行业类型</option>
                <option th:each="obj:${industryList}" th:value="${obj.bdName}" th:text="${obj.bdName}"></option>
            </select>
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>渠道来源：</label>
        <div class="layui-input-block">
            <select name="channelSource" lay-verify="required" lay-search lay-filter="source_select">
                <option value="">请选择渠道来源</option>
                <option th:each="obj:${sourceList}" th:value="${obj.bdName}" th:text="${obj.bdName}"></option>
            </select>
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">渠道名称：</label>
        <div class="layui-input-block">
            <select name="sourceName" class="sourceName" lay-search>
                <option value="">请选择渠道名称</option>
            </select>
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;箱：</label>
        <div class="layui-input-block">
            <input type="text" name="email" placeholder="请输入邮箱" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编：</label>
        <div class="layui-input-block">
            <input type="text" name="zipCode" placeholder="请输入邮编"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md8 layui-col-xs8 l_po">
        <label class="layui-form-label w_label ">通讯地址：</label>
        <div class="layui-input-block">
            <input type="text" name="linkAddress" placeholder="请输入通讯地址"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
</script>
<!--公司信息部分end-->

<!--个人信息部分end-->
<script type="text/html" id="personal_part">
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>客户姓名：</label>
        <div class="layui-input-block">
            <input type="text" name="customerName" lay-verify="required"  placeholder="请输入客户姓名"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">身份证号：</label>
        <div class="layui-input-block">
            <input type="text" name="contactsCard" placeholder="请输入身份证号"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>联系电话：</label>
        <div class="layui-input-block">
            <input type="text" name="phone" lay-verify="required|phone" placeholder="请输入联系电话"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">工作单位：</label>
        <div class="layui-input-block">
            <input type="text" name="workUnit" placeholder="请输入工作单位" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>行业类型：</label>
        <div class="layui-input-block">
            <select name="industry" lay-verify="required" lay-search>
                <option value="">请选择行业类型</option>
                <option th:each="obj:${industryList}" th:value="${obj.bdName}" th:text="${obj.bdName}"></option>
            </select>
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label "><b class="w_sur">*</b>渠道来源：</label>
        <div class="layui-input-block">
            <select name="channelSource" lay-verify="required" lay-search lay-filter="source_select">
                <option value="">请选择渠道来源</option>
                <option th:each="obj:${sourceList}" th:value="${obj.bdName}" th:text="${obj.bdName}"></option>
            </select>
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">渠道名称：</label>
        <div class="layui-input-block">
            <select name="sourceName" class="sourceName" lay-search>
                <option value="">请输入渠道名称</option>
            </select>
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;箱：</label>
        <div class="layui-input-block">
            <input type="text" name="email" placeholder="请输入邮箱"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md4 layui-col-xs6 l_po">
        <label class="layui-form-label w_label ">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编：</label>
        <div class="layui-input-block">
            <input type="text" name="zipCode" placeholder="请输入邮编"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-col-md8 layui-col-xs8 l_po">
        <label class="layui-form-label w_label ">通讯地址：</label>
        <div class="layui-input-block">
            <input type="text" name="linkAddress" placeholder="请输入通讯地址"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
</script>
<!--个人信息部分end-->
<script id="source-templete" type="text/html">
    {{if list.length>0}}
    <option value="">请选择渠道名称</option>
    {{each list as obj index}}
    <option value="{{obj.channelName}}">{{obj.channelName}}</option>
    {{/each}}
    {{else}}
    <option value="">无数据</option>
    {{/if}}
</script>
<script>
    layui.config({
        base: URL + 'layuiadmin/'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'contlist', 'form', 'upload', 'laydate', 'table'], function () {
        var form = layui.form,
            layer = layui.layer,
            upload = layui.upload,
            laydate = layui.laydate;

        var company_part = $('#company_part').html();
        var personal_part = $('#personal_part').html();
        $('.lease-info-switch').html(company_part); // 默认公司租赁
        form.render();
        form.on("radio(customerType-select)", function (data) {
            var val = data.value;
            $('#leaseType').val(val);
            if (val == '1') { // 公司租赁
                $('.lease-info-switch').html(company_part);
                $("#gsxx").css('display','block');
            } else if (val == '2') { // 个人租赁
                $('.lease-info-switch').html(personal_part);
                $("#gsxx").css('display','none');
            }
            form.render();
        });

        form.on('select(source_select)', function (data) {
            var channelSource = data.value;
            if (channelSource != '') {
                $.ajax({
                    url: URL + "queryChannelBaseList",
                    type: "POST",
                    data: {
                        channelSource: channelSource
                    },
                    dataType: "json",
                    success: function (data) {
                        var len = data.list.length;
                        if(len > 0){
                            console.log(JSON.stringify(data));
                            var html = template('source-templete', data);
                            $('.sourceName').html(html);
                        }else{
                            $('.sourceName').html('<option value="">无数据</option>');
                        }
                        form.render('select');
                    }
                });
            } else {
                $('.sourceName').html('<option value="">无数据</option>');
                form.render('select');
            }
        });

        form.on('submit(commit)', function () {
            var formData = $("#form").serializeObject();
            $.ajax({
                url: URL + "customer/insertCustomer",
                type: "POST",
                data: formData,
                dataType: "json",
                success: function (data) {
                    if (data.success) {
                        layer.msg(data.msg);
                        setTimeout(function () {
                            parent.location.reload();
                            // parent.table.reload('dataList');
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        }, 1000);
                    } else {
                        layer.msg(data.msg);
                    }
                }
            });
        });

        lay('.laydate-control').each(function () {
            laydate.render({
                elem: this,
                trigger: 'click'
            });
        });

        //取消按钮
        $('body').on('click', '.close', function () {
            layer.closeAll();
        })

        //取消按钮
        $('body').on('click', '.cancel', function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })
    });
</script>
</body>
</html>